(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["fly-banner"],{"0291":function(t,e,i){"use strict";i.r(e);var s=i("ade3"),a=function(){var t=this,e=t._self._c;return t.showPage&&"top"===t.partProps.floatPosition?e("van-sticky",{staticStyle:{width:"100%"},attrs:{"offset-top":t.offsetTop,"z-index":"100"},on:{change:t.handleStickyChange}},[e("div",{ref:"flyBanner",staticClass:"content",style:t.isShowFly?"":"position: absolute; opacity: 0;"},[e("div",{staticClass:"fadeIn-fly"},[t._l(t.picList,(function(i,s){return[i.picUrl?e("specialImage",{key:s,staticClass:"banner",attrs:{ignoreLazy:"",url:i.picUrl},on:{load:t.handleImgLoad,tap:function(e){return t.handleClick(i)}}}):t._e()]})),t.partProps.isClose?e("img",{staticClass:"fly-banner-close",attrs:{src:"https://staticontent.shop2cn.cn/shop2cn/mp/images/skins/fly-banner/close.png"},on:{click:t.close}}):t._e()],2)])]):t.showPage?e("div",{ref:"flyBanner",class:["content",!t.isDev&&"content-bottom"],style:Object(s["a"])({position:t.isShowFly?"":"absolute",opacity:t.isShowFly?"":"0",bottom:!t.isDev&&t.offsetBottom?t.offsetBottom+"px":"0"},"opacity",t.imgOpacity)},[e("div",{staticClass:"fadeIn-fly"},[t._l(t.picList,(function(i,s){return[i.picUrl?e("specialImage",{key:s,staticClass:"banner",attrs:{ignoreLazy:"",url:i.picUrl},on:{load:t.handleImgLoad,tap:function(e){return t.handleClick(i)}}}):t._e()]})),t.partProps.isClose?e("img",{staticClass:"fly-banner-close",attrs:{src:"https://staticontent.shop2cn.cn/shop2cn/mp/images/skins/fly-banner/close.png"},on:{click:t.close}}):t._e()],2)]):t._e()},n=[],r=i("5530"),o=(i("0cc8"),i("3104")),c=(i("e9c4"),i("a9e3"),i("f354")),l=i("a8f5"),h=i("b023"),p=i("ed08");function f(t,e){try{window.sessionStorage.setItem(t,JSON.stringify(e))}catch(i){console.info(i)}}function d(t){try{var e=window.sessionStorage.getItem(t);return e?JSON.parse(e):null}catch(i){return console.info(i),null}}var u={mixins:[c["a"]],components:{"van-sticky":o["a"],specialImage:h["a"]},name:"fly-banner",props:{isDev:{type:Boolean,default:!1},part:{type:Object},stickyData:{type:Object},pageStyleMode:{type:Number,default:0},isActive:{type:Boolean}},data:function(){return{offsetTop:0,offsetBottom:0,isFixed:!1,showPage:!0,scrollScreen:!1,picList:[],firstEnter:!1}},computed:{partProps:function(){var t=this,e=Object(r["a"])({},this.part&&this.part.partProps||{});return setTimeout((function(){t.handleStickyArrHeight(t.$refs.flyBanner)}),500),this.$emit("fixedFlyBanner",e.floatPosition),e},imgOpacity:function(){return!this.isActive&&this.isDev?.75:1},isShowFly:function(){return this.isDev||this.scrollScreen||1==this.partProps.floatDisplayType}},watch:{"part.dataItems":{immediate:!0,handler:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.isDev&&(Object(p["c"])(t)||!t[0].picUrl?this.picList=[{picUrl:"https://staticontent.shop2cn.cn/shop2cn/mp/images/skins/fly-banner/default.png"}]:this.picList=t)}},stickyData:{handler:function(t){t&&this.getOffsetTop()}},part:{immediate:!0,handler:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t.partId&&!this.firstEnter){var e=d("_ISFLYBANNERCLOSE__"+this.part.partId);this.showPage=!e,this.isDev||e||(this.getOffsetTop(),this.getPartData()),this.firstEnter=!0}}}},created:function(){},mounted:function(){window.addEventListener("scroll",this.handleScroll),this.handleScroll()},methods:{handleImgLoad:function(t){this.handleStickyArrHeight(this.$refs.flyBanner)},getPartData:function(){var t=this;this.getDatas((function(e){e&&e.list&&e.list.length&&(t.picList=e.list)}))},handleScroll:function(){if(2==this.partProps.floatDisplayType&&this.showPage){var t=document.documentElement.scrollTop||document.body.scrollTop,e="".concat(document.documentElement.clientHeight),i=t>=1.5*e;i!==this.scrollScreen&&(this.scrollScreen=i),this.handleStickyArrHeight(this.$refs.flyBanner)}},close:function(){this.showPage=!1,f("_ISFLYBANNERCLOSE__"+this.part.partId,!0),this.$emit("changeStickyData",{changeData:{sticky:!1,height:0},partId:this.part.partId})},handleStickyArrHeight:function(t){var e=t.offsetHeight;this.isDev&&e>0&&"bottom"==this.partProps.floatPosition&&this.$emit("getFlyBannerHeight",e),this.scrollScreen||2!=this.partProps.floatDisplayType||(e=0),this.$emit("changeStickyData",{changeData:{height:e},partId:this.part.partId})},handleStickyChange:function(t){t&&this.getOffsetTop(),this.$emit("changeStickyData",{changeData:{sticky:t},partId:this.part.partId}),this.isFixed=t},getOffsetTop:function(){for(var t=this.stickyData,e=0,i=0,s=document.querySelector(".tabbar"),a=s?s.offsetHeight:0,n=a;e<t.stickyArr.length;e++){var r=t.stickyArr[e];if(r.partId===this.part.partId)break;"top"==r.position?i+=r.height||0:n+=r.height||0}"bottom"==this.partProps.floatPosition?this.offsetBottom=n>0?n-1:n:this.offsetTop=i>0?i-1:i},handleClick:function(t){Object(l["b"])(this.getLinkData(t),this.ylogParams)}},destroyed:function(){window.removeEventListener("scroll",this.handleScroll)}},g=u,m=(i("25c1"),i("2877")),y=Object(m["a"])(g,a,n,!1,null,"d5d0ecf8",null);e["default"]=y.exports},"02de":function(t,e,i){"use strict";function s(t){var e=window.getComputedStyle(t),i="none"===e.display,s=null===t.offsetParent&&"fixed"!==e.position;return i||s}i.d(e,"a",(function(){return s}))},"0cc8":function(t,e,i){"use strict";i("68ef"),i("ae9e")},2532:function(t,e,i){"use strict";var s=i("23e7"),a=i("e330"),n=i("5a34"),r=i("1d80"),o=i("577e"),c=i("ab13"),l=a("".indexOf);s({target:"String",proto:!0,forced:!c("includes")},{includes:function(t){return!!~l(o(r(this)),o(n(t)),arguments.length>1?arguments[1]:void 0)}})},"25c1":function(t,e,i){"use strict";i("32c9")},3104:function(t,e,i){"use strict";var s=i("02de"),a=i("ea8e"),n=i("d282"),r=i("a142"),o=i("a8c1"),c=i("5fbe"),l=Object(n["a"])("sticky"),h=l[0],p=l[1];e["a"]=h({mixins:[Object(c["a"])((function(t,e){if(this.scroller||(this.scroller=Object(o["d"])(this.$el)),this.observer){var i=e?"observe":"unobserve";this.observer[i](this.$el)}t(this.scroller,"scroll",this.onScroll,!0),this.onScroll()}))],props:{zIndex:[Number,String],container:null,offsetTop:{type:[Number,String],default:0}},data:function(){return{fixed:!1,height:0,transform:0}},computed:{offsetTopPx:function(){return Object(a["b"])(this.offsetTop)},style:function(){if(this.fixed){var t={};return Object(r["c"])(this.zIndex)&&(t.zIndex=this.zIndex),this.offsetTopPx&&this.fixed&&(t.top=this.offsetTopPx+"px"),this.transform&&(t.transform="translate3d(0, "+this.transform+"px, 0)"),t}}},watch:{fixed:function(t){this.$emit("change",t)}},created:function(){var t=this;!r["g"]&&window.IntersectionObserver&&(this.observer=new IntersectionObserver((function(e){e[0].intersectionRatio>0&&t.onScroll()}),{root:document.body}))},methods:{onScroll:function(){var t=this;if(!Object(s["a"])(this.$el)){this.height=this.$el.offsetHeight;var e=this.container,i=this.offsetTopPx,a=Object(o["c"])(window),n=Object(o["a"])(this.$el),r=function(){t.$emit("scroll",{scrollTop:a,isFixed:t.fixed})};if(e){var c=n+e.offsetHeight;if(a+i+this.height>c){var l=this.height+a-c;return l<this.height?(this.fixed=!0,this.transform=-(l+i)):this.fixed=!1,void r()}}a+i>n?(this.fixed=!0,this.transform=0):this.fixed=!1,r()}}},render:function(){var t=arguments[0],e=this.fixed,i={height:e?this.height+"px":null};return t("div",{style:i},[t("div",{class:p({fixed:e}),style:this.style},[this.slots()])])}})},"32c9":function(t,e,i){},9853:function(t,e,i){},ae9e:function(t,e,i){},b023:function(t,e,i){"use strict";var s=function(){var t=this,e=t._self._c;return t.ignoreLazy?e("div",{staticClass:"special-img"},[t.norImgUrl?e("img",{ref:"pic",staticClass:"img img--normal",attrs:{src:t.norImgUrl},on:{load:t.handleImgLoad,click:function(e){return e.stopPropagation(),t.handleTap.apply(null,arguments)}}}):t._e(),t.gifImgUrl?e("img",{staticClass:"img img--gif",attrs:{src:t.gifImgUrl},on:{click:function(e){return e.stopPropagation(),t.handleTap.apply(null,arguments)}}}):t._e()]):e("div",{staticClass:"special-img"},[t.norImgUrl?e("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t.norImgUrl,expression:"norImgUrl"}],ref:"pic",staticClass:"img img--normal",on:{load:t.handleImgLoad,click:function(e){return e.stopPropagation(),t.handleTap.apply(null,arguments)}}}):t._e(),t.gifImgUrl?e("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t.gifImgUrl,expression:"gifImgUrl"}],staticClass:"img img--gif",on:{click:function(e){return e.stopPropagation(),t.handleTap.apply(null,arguments)}}}):t._e()])},a=[],n=i("fae7"),r=n["a"],o=(i("b277"),i("2877")),c=Object(o["a"])(r,s,a,!1,null,"5ecb013a",null);e["a"]=c.exports},b277:function(t,e,i){"use strict";i("9853")},f354:function(t,e,i){"use strict";(function(t){var s=i("5530"),a=(i("caad"),i("2532"),i("d3b7"),i("b00c")),n=function(){},r={props:{isDev:{type:Boolean,default:!1},pageData:{type:Object,default:function(){return{}}},ylogParams:{type:Object,default:function(){return{}}}},methods:{getLinkData:function(t){var e=this.pageData&&this.pageData.tempCode||"";return[a["c"].BRAND_SUBJECT,a["c"].INBUY_SUBJECT].includes(e)&&(t.partId=this.part.partId||"",a["c"].BRAND_SUBJECT===e&&(t.brandId=this.pageData.brandId||""),a["c"].INBUY_SUBJECT===e&&(t.activityId=this.activityId||"",t.activityType=this.activityType||"")),t},fetchPartData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=this.part,a=i.partId,n=i.dataItems,r=i.partProps;return this.isDev?Promise.resolve({list:n||[],partProps:r}):a?t.request({url:"/api/prod/shophomepartdata",method:"get",params:Object(s["a"])(Object(s["a"])({},e),{},{PartId:a})}):Promise.reject({message:"partId 不存在"})},fetchPartCenterData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=this.part,a=i.dataItems,n=i.partProps;return this.isDev?Promise.resolve({list:a||[],partProps:n}):t.request({url:"/api/prod/shopcouponcentercouponlist",method:"get",params:Object(s["a"])({},e)})},getDatas:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n,s=this.part,a=s.partId,r=s.dataItems,o=s.partProps;this.isDev?e({list:r||[],partProps:o}):a?t.request({url:"/api/prod/shophomepartdata?PartId=".concat(a),method:"get"}).then((function(t){e(t||{})})).catch((function(t){i(t)})):i({message:"partId 不存在"})}}};e["a"]=r}).call(this,i("7189")["default"])},fae7:function(t,e,i){"use strict";(function(t){var s=i("a026"),a=i("caf9");s["default"].use(a["a"]),e["a"]={props:{dataset:{type:Object,default:function(){return{}}},ignoreLazy:{type:Boolean,default:!1},url:{type:String}},data:function(){return{norImgUrl:"",gifImgUrl:""}},watch:{url:{immediate:!0,handler:function(e){var i=t.parseImgUrl(e),s=i.imgUrl,a=i.maskUrl,n=void 0===a?"":a;this.norImgUrl=s,this.gifImgUrl=n}}},methods:{handleImgLoad:function(){this.$emit("load",this.$refs.pic.clientHeight),this.$emit("updateImageHeight",{height:this.$refs.pic.naturalHeight,width:this.$refs.pic.naturalWidth},this.dataset)},handleTap:function(t){this.$emit("tap",t)}}}}).call(this,i("7189")["default"])}}]);