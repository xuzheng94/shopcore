(function(t){function e(e){for(var a,n,r=e[0],c=e[1],d=e[2],u=0,h=[];u<r.length;u++)n=r[u],Object.prototype.hasOwnProperty.call(s,n)&&s[n]&&h.push(s[n][0]),s[n]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);l&&l(e);while(h.length)h.shift()();return o.push.apply(o,d||[]),i()}function i(){for(var t,e=0;e<o.length;e++){for(var i=o[e],a=!0,r=1;r<i.length;r++){var c=i[r];0!==s[c]&&(a=!1)}a&&(o.splice(e--,1),t=n(n.s=i[0]))}return t}var a={},s={"pages/purchasein":0},o=[];function n(e){if(a[e])return a[e].exports;var i=a[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=a,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(i,a,function(e){return t[e]}.bind(null,a));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=e,r=r.slice();for(var d=0;d<r.length;d++)e(r[d]);var l=c;o.push([100,"chunk-vendors","chunk-common"]),i()})({100:function(t,e,i){t.exports=i("b2a1")},"4a0f":function(t,e,i){},"4abf":function(t,e,i){"use strict";(function(t){i("ac1f"),i("841c"),i("a9e3"),i("99af"),i("b0c0");var a=i("191e"),s=i("603c"),o=i("b68d"),n=i("4696"),r=i("fe47"),c=i("b00c"),d=i("3841"),l=i("ed08");e["a"]={name:"PurchaseinCustom",components:{skinwrap:d["default"],previewTips:n["a"]},mixins:[a["a"],s["a"],o["a"]],props:["authCode","pageId"],data:function(){return{activityId:"",pageStatus:1,pageData:{},parts:[],pageStyleMode:null,emptyMsg:"",pageName:"",sellerInfo:{},isPreview:0,gifImgUrl:"",mchId:"",isLogin:t.auth.islogin(),activityType:c["a"].PURCHASE}},computed:{wrapperStyle:function(){return this.moduleStyle(this.pageData)}},created:function(){var t=this,e=l["a"].parseLocator(window.location.search),i=1===Number(e.preview)?1:0;r["a"].init(e,(function(e){t.mchId=e})),this.isPreview=i},mounted:function(){this.getExtraData(),this.getPageData()},beforeDestroy:function(){},methods:{checkLogin:function(){return!!t.auth.islogin()||(t.auth.tologin(),!1)},getExtraData:function(){var e=this;t.request({url:"/api/prod/sqshopextra"}).then((function(t){var i=t.sellerInfo||{};e.sellerInfo=i})).catch((function(t){console.log(t)}))},fetchPageData:function(){return t.request({url:"/api/prod/shophomepageinfo?MerchantId=".concat(this.mchId,"&PageId=").concat(this.pageId,"&tokenCode=").concat(this.authCode)})},getPageData:function(){var e=this;if(!this.pageId)return this.emptyMsg=this.$t("showskin.hani_failed"),void(this.pageStatus=3);this.fetchPageData().then((function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(i.code||i.msg)return e.pageStatus=3,void(e.emptyMsg=i.msg||i.message||e.$t("showskin.data_loading_failure"));i.parts&&i.parts.length?(i.name&&(e.pageName=i.name,t.setNavigationBarTitle({title:i.name})),e.pageData=i,e.parts=i.parts,e.pageStyleMode=i.pageStyleMode||1,e.pageStatus=2,i.activityInfo&&i.activityInfo.activityId&&(e.activityId=i.activityInfo.activityId)):e.pageStatus=3})).catch((function(){e.pageStatus=3,t.showToast({title:e.$t("showactivity.failed_activity")})}))},moduleStyle:function(t){var e={},i="";if(t&&t.bgPicUrl){var a=this.handleImgUrl(t.bgPicUrl),s=a.gifImgUrl,o=a.norImgUrl;o&&(e.backgroundImage="url('".concat(o,"')")),s&&(i=s)}return t&&(e.backgroundColor=t.bgColor||"#fff"),this.gifImgUrl=i,e},handleImgUrl:function(e){var i="",a="",s=t.parseImgUrl(e),o=s.imgUrl,n=s.maskUrl;return a=o,n&&(i=n),{gifImgUrl:i,norImgUrl:a}}}}}).call(this,i("7189")["default"])},"625e":function(t,e,i){"use strict";var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"wrapper",style:t.pageThemeStyle},[t.isLogin?t._e():e("div",{staticClass:"check-login-mask",on:{click:t.checkLogin}}),t.isPreview?e("preview-tips"):t._e(),1===t.pageStatus?e("div",{staticClass:"placeholder"}):t._e(),2===t.pageStatus?e("div",{staticClass:"showskin",style:t.wrapperStyle},[t.gifImgUrl?e("div",{staticClass:"showskin-mask",style:{backgroundImage:"url('".concat(t.gifImgUrl,"')")}}):t._e(),e("skinwrap",{attrs:{parts:t.parts,pageId:t.pageId,authCode:t.authCode,pageName:t.pageName,activityId:t.activityId,pageData:t.pageData,isPreview:t.isPreview,sellerInfo:t.sellerInfo,pageStyleMode:t.pageStyleMode,activityType:t.activityType}})],1):t._e(),3===t.pageStatus?e("div",{staticClass:"empty_home"},[e("img",{staticClass:"empty-image",attrs:{src:i("4f3c")}}),e("div",{staticClass:"empty_msg"},[t._v(t._s(t.emptyMsg))])]):t._e()],1)},s=[],o=i("4abf"),n=o["a"],r=(i("deba"),i("f477"),i("2877")),c=Object(r["a"])(n,a,s,!1,null,"4e302607",null);e["a"]=c.exports},b2a1:function(t,e,i){"use strict";i.r(e);i("e260"),i("e6cf"),i("cca6"),i("a79d");var a=i("56d7"),s=(i("b0c0"),function(){var t=this,e=t._self._c;return e("div",[t.activityInfo.customSubject&&t.voluntarilyCode?e("PurchaseinCustom",{attrs:{authCode:t.authCode,pageId:t.activityInfo.pageId}}):e("div",{class:["container",{"container-hidden":t.empty}],style:[{background:t.bgColor},t.pageThemeStyle]},[t.isLogin||3===t.activityInfo.conditionType?t._e():e("div",{staticClass:"check-login-mask",on:{click:t.checkLogin}}),t.loading&&0===t.pageIndex?e("div",{staticClass:"loading"},[e("loading-line")],1):t._e(),t.hideHeader?t._e():e("purchase-header",{attrs:{bannerUrl:t.bannerUrl||t.defaultBanner,logo:t.iconUrl,name:t.name,bgColor:t.bgColor,showLogo:t.showLogo}},[e("div",{staticClass:"card-container",attrs:{slot:"cardTitle"},slot:"cardTitle"},[e("img",{staticClass:"card-container-top",attrs:{src:i("bd11")}}),e("div",{class:[t.showLogo?"container-content-height":"container-content-low"]}),e("div",{staticClass:"container-content"},[e("div",{staticClass:"content-abs"},[3===t.firstData.activityStatus?e("div",{staticClass:"content-date content-date--font-weight"},[t._v("活动已结束")]):e("div",{staticClass:"content-date"},[t._v(t._s(t.firstData.beginTime)+" - "+t._s(t.firstData.endTime))]),t.activityInfo.showPromptScheme?e("div",{staticClass:"content-desc"},[t._v("可从个人中心-我的内购 进入")]):t._e()])]),e("img",{staticClass:"card-container-bottom",attrs:{src:i("836f")}})])]),t.initListShow?e("div",{staticClass:"card-search"},[e("div",{staticClass:"filter-bar-placeholder"}),e("filter-bar",{staticStyle:{background:"#fff"},attrs:{isFilterFixed:"",source:"search",filterList:t.filterList,"is-show-product":!0,selectedList:t.selectedList,purchasingPlaceholder:t.purchasingPlaceholder},on:{getSearchResult:t.getSearchResult}})],1):t._e(),e("div",{class:["prod",t.empty&&"prod-empty-vacancy"]},[3===t.firstData.activityStatus?e("div",{staticClass:"prod-mask"},[e("div",{staticClass:"mask"})]):t._e(),t.prodList.length>0?e("div",{staticClass:"prod-list"},[e("product-list-card",{attrs:{prodList:t.prodList,showPriceControlType:!1,prodType:2,prodSkinData:t.prodSkinData,navigatorParams:t.navigatorParams,priceLabel:"活动价",cardType:"purchasein",fixDiscountLabelPlaced:!0}})],1):t._e(),t.prodList.length>0?e("loadmore",{attrs:{loading:t.loading&&t.pageIndex>0,hasMore:t.loadMore,color:"#fff"}}):t._e(),t.empty?e("div",{staticClass:"prod-empty"},[e("img",{staticClass:"empty-img",attrs:{src:i("1d96"),alt:""}}),e("div",{staticClass:"empty-desc",domProps:{innerHTML:t._s(t.emptyDesc)}})]):t._e()],1)],1),t.watermarkText?e("watermark",{attrs:{watermarkText:t.watermarkText}}):t._e()],1)}),o=[],n=i("f69d"),r=n["a"],c=(i("c422"),i("2877")),d=Object(c["a"])(r,s,o,!1,null,"6a86efbe",null),l=d.exports;i.p=publicPath,Object(a["a"])(l)},c422:function(t,e,i){"use strict";i("ee71")},deba:function(t,e,i){"use strict";i("4a0f")},e6a1:function(t,e,i){},ee71:function(t,e,i){},f477:function(t,e,i){"use strict";i("e6a1")},f69d:function(t,e,i){"use strict";(function(t){var a=i("5530"),s=i("2909"),o=(i("ac1f"),i("841c"),i("a9e3"),i("d3b7"),i("c740"),i("a434"),i("b64b"),i("b0c0"),i("00b4"),i("fb6a"),i("99af"),i("b68d")),n=i("603c"),r=i("cd92"),c=i("bce3"),d=i("44e4"),l=i("ed08"),u=i("9fe6"),h=i("13cb"),g=i("4846"),p=i("8efd"),f=i("625e");e["a"]={components:{"purchase-header":u["a"],productListCard:r["a"],loadingLine:d["a"],loadmore:c["a"],filterBar:h["a"],watermark:p["a"],PurchaseinCustom:f["a"]},mixins:[n["a"],o["a"]],data:function(){return{loading:!1,bannerUrl:"",iconUrl:"",bgColor:"#D3EDF7",titleTimerColor:"#090a0e",pageIndex:0,firstData:{},prodList:[],loadMore:!1,hideHeader:!0,isLogin:t.auth.islogin(),activityId:0,authCode:"",navigatorParams:{TradingSpecial:1},activityStatus:1,filterList:{},show:!1,maxPageIndex:0,prodListEmpty:!1,selectedList:{},showLogo:!0,initListShow:!1,showPage:!1,userInfo:{},watermarkText:"",activityInfo:{},purchasingPlaceholder:"",voluntarilyCode:!1}},computed:{defaultBanner:function(){var t=i("79fd");return t},empty:function(){return this.showPage&&!this.initListShow&&0===this.prodList.length},emptyDesc:function(){var t=this.firstData.activityStatus,e="";return this.voluntarilyCode?2===t?e="活动未开始，敬请期待":3===t&&(e="活动已结束"):e="登录后可继续浏览内购商品<br/>2秒后将自动跳转登录页",e}},mounted:function(){var e=this,i=l["a"].parseUrl(window.location.search,"lower"),a=1===Number(i.preview)?1:0;if(a)return this.activityInfo.customSubject=!0,this.voluntarilyCode=!0,void(this.activityInfo.pageId=i.pageid);this.activityId=i.id,this.authCode=i.code;var s={activityId:i.id,authCode:i.code};t.isMiniApp&&i&&i.buycode&&(s.buyCode=i.buycode),this.checkValidBind(s).then((function(a){a?(e.activityInfo=a,e.getActivityInfo(a)):t.isMiniApp?wx.miniProgram.redirectTo({url:"/subPackage/pages/purchaseincheck/purchaseincheck?id=".concat(i.id||"")}):t.redirectTo({url:"/pages/purchaseincheck/main?id=".concat(i.id||"")})})),t.onShow((function(){console.log("触发内购页onShow",e.activityInfo),e.voluntarilyCodeIslogin(e.activityInfo)}))},onReachBottom:function(){if(!this.loading&&this.loadMore){this.pageIndex+=1;var t=this.pageIndex>this.maxPageIndex||this.prodListEmpty;if(t)return;this.getSearchResult({needClearOldData:!1,refreshProduct:!0})}},methods:{checkLogin:function(){return!!t.auth.islogin()||(t.auth.tologin(),!1)},checkValidBind:function(e){var i=this,a=e.activityId,o=e.authCode,n=e.buyCode;return new Promise((function(e){i.loading=!0;var r={activityid:a,tokenCode:o,cookie:t.auth.getCookieId()};n&&(r.buyCode=n),t.request({url:"/api/prod/shopactivity",data:r}).then((function(o){if(o&&o.tokenCode&&(i.authCode=o.tokenCode,!t.auth.isLogin)){var n=g["a"].getSessionStorage("pruchaseinAuth")||[],r=Object(s["a"])(n),c=n.findIndex((function(t){return t.id===a}));c>-1&&r.splice(c,1),r.push({cookieId:t.auth.getCookieId(),id:a,code:o.tokenCode}),g["a"].setSessionStorage("pruchaseinAuth",r)}Object(l["c"])(o)||0===o.authorizeStatus||2===o.authorizeStatus&&!i.authCode?e(!1):(i.activityStatus=o.activityStatus,2===o.authorizeStatus&&i.isLogin&&i.handleBindActivity(),i.loading=!1,e(o))})).catch((function(e){i.loading=!1,t.showToast({title:e.msg||"获取活动信息失败，请重试",duration:2e3})}))}))},getActivityInfo:function(e){if(e){if(0===Object.keys(e).length)return void(0===Object.keys(this.firstData).length&&(this.hideHeader=!0));this.hideHeader=!1,this.name=e.name;var i=e.designConfig.backgroundColor;if(/^https?/.test(e.activityBanner)&&(this.bannerUrl=e.activityBanner),/^https?/.test(e.activityIcon)&&(this.iconUrl=e.activityIcon),e.imageWaterMark&&this.getUserInfo(),this.bgColor=i||"#D3EDF7",this.showLogo=!!e.showLogo,this.firstData=Object(a["a"])({},e),t.setNavigationBarTitle({title:e.name||""}),this.voluntarilyCode=this.voluntarilyCodeIslogin(e),!this.voluntarilyCode)return;this.getSearchResult({needClearOldData:!0,showloading:!0,refreshProduct:!0})}},getUserInfo:function(){var e=this,i=this;t.request("/api/usercenter/squserinfo").then((function(a){if(i.userInfo=a,i.userInfo){var s=i.userInfo.nickname||"";s=s.slice(0,8),e.watermarkText="内购严禁转发 ID".concat(t.auth.getValue("userId")," ").concat(s),e.purchasingPlaceholder=Number(t.auth.getValue("userId"))-123456789}})).catch((function(e){t.showToast({title:e.msg||e.message})}))},voluntarilyCodeIslogin:function(e){var i=this;if(3===e.conditionType&&!t.auth.islogin()){clearTimeout(a);var a=null;return this.showPage=!0,t.showToast({title:"请先完成授权",duration:2e3}),a=setTimeout((function(t){i.checkLogin()}),2e3),!1}return!0},handleBindActivity:function(){t.request({url:"api/prod/sqbindactivity",method:"POST",data:{tokenCode:this.authCode,activityId:this.activityId}}).then((function(e){var i=e.data;i&&i.success||t.showToast({title:"绑定活动失败，请返回重试",duration:2e3})})).catch((function(e){t.showToast({title:e.msg||e.message||"绑定活动失败，请返回重试",duration:2e3})}))},getSearchResult:function(e){var i=this,s=e.needClearOldData,o=e.queryObj,n=e.selectedList,r=e.refreshProduct,c=e.showloading,d=e.changeKeyword,l=t.parseLocator(window.location.search,"lower");this.pageIndex=s?1:this.pageIndex,o&&(this.queryObj=Object(a["a"])({},o)),n&&(this.selectedList=n);var u=Object(a["a"])(Object(a["a"])({},this.queryObj),{},{pageIndex:this.pageIndex,activityId:l.id,refreshProduct:r});if(this.authCode&&(u.tokenCode=this.authCode),!this.loading){this.selectedList&&(t.isBlank(this.selectedList.brandList)||(u.brandList=this.selectedList.brandList),t.isBlank(this.selectedList.categoryList)||(u.thirdCategoryList=this.selectedList.categoryList,u.firstCategoryList=[],u.secondCategoryList=[]),u.minPrice=this.selectedList.minPrice,u.maxPrice=this.selectedList.maxPrice),u.keyword||delete u.keyword,c&&t.showLoading(),this.loading=!0;var h="/api/prod/sqactivityproductsearch";t.request({url:h,data:u,method:"post"}).then((function(e){if(i.loading=!1,i.showPage=!0,e.list&&e.list.length&&(i.initListShow=!0),c&&t.hideLoading(),r){if((e.filterList&&t.isBlank(i.filterList)||d)&&(i.filterList=Object(a["a"])({},e.filterList||{})),(!e.list||!e.list.length)&&(!i.prodList.length||s))return void(s&&(i.prodList=[]));var o=e.list||[],l=i.prodList,h=s?o:l.concat(o),g=!e.list||0===e.list.length,p=e.count||0;i.prodList=h,i.maxPageIndex=p,i.prodListEmpty=g,i.selectedList=(n?i.selectedList:e.selectedList)||{},i.loadMore=u.pageIndex<p&&!g,s&&(document.documentElement.scrollTop=document.body.scrollTop=0)}})).catch((function(e){i.loading=!1,i.showPage=!0,c&&t.hideLoading(),t.showToast({title:e.message||i.$t("makeup.search_failed")})}))}}}}}).call(this,i("7189")["default"])}});