(function(t){function e(e){for(var i,s,r=e[0],c=e[1],l=e[2],u=0,h=[];u<r.length;u++)s=r[u],Object.prototype.hasOwnProperty.call(n,s)&&n[s]&&h.push(n[s][0]),n[s]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);d&&d(e);while(h.length)h.shift()();return o.push.apply(o,l||[]),a()}function a(){for(var t,e=0;e<o.length;e++){for(var a=o[e],i=!0,r=1;r<a.length;r++){var c=a[r];0!==n[c]&&(i=!1)}i&&(o.splice(e--,1),t=s(s.s=a[0]))}return t}var i={},n={"pages/purchaseincheck":0},o=[];function s(e){if(i[e])return i[e].exports;var a=i[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.e=function(){return Promise.resolve()},s.m=t,s.c=i,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(a,i,function(e){return t[e]}.bind(null,i));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=e,r=r.slice();for(var l=0;l<r.length;l++)e(r[l]);var d=c;o.push([101,"chunk-vendors","chunk-common"]),a()})({101:function(t,e,a){t.exports=a("cb04")},"51ce":function(t,e,a){"use strict";(function(t){var i=a("2909"),n=a("5530"),o=(a("66b9"),a("b650")),s=(a("be7f"),a("565f")),r=(a("ac1f"),a("841c"),a("00b4"),a("b0c0"),a("c740"),a("a434"),a("99af"),a("d606")),c=a("0db1"),l=a("b0ab"),d=a("4846"),u=a("ed08"),h=a("9fe6"),p={smsApi:"/api/usercenter/sqsendverifycode",bindMobile:"/api/usercenter/bindmobile",sqsendverifycode:"/api/usercenter/sqsendverifycode",sqweblogin:"/api/usercenter/sqweblogin"};e["a"]={components:{"van-field":s["a"],"van-button":o["a"],countryDialog:r["a"],TCaptcha:c["a"],"purchase-header":h["a"]},data:function(){return{loading:!1,isCheckPhone:!0,bannerUrl:"",iconUrl:"",bgColor:"#D3EDF7",btnColor:"#1a77ff",validateObj:{},countryInfo:{cnTitle:"中国大陆",areaCode:"86"},illegal:{phone:"",sms:"",code:"",warning:""},showDialog:!1,areaList:[],isSending:!1,s:60,isLogin:t.auth.islogin(),activityId:0,title:"",activityStatus:1,showLogo:!0}},computed:{defaultBanner:function(){var t=a("79fd");return t},btnDisabled:function(){var t=this.validateObj,e=t.phone,a=t.sms,i=t.code;return!(e&&a||i)}},mounted:function(){var t=u["a"].parseUrl(window.location.search,"lower");this.activityId=t.id,this.fetchInfo({activityId:t.id})},methods:{fetchInfo:function(e){var a=this,i=e.activityId,n=void 0===i?1:i,o={activityid:n};this.loading=!0,t.request({url:"api/prod/shopactivity",data:o}).then((function(e){if(a.loading=!1,e){a.isCheckPhone=2===e.conditionType;var i=e.designConfig||{},n=i.backgroundColor,o=i.btnColor;/^https?/.test(e.activityBanner)&&(a.bannerUrl=e.activityBanner),/^https?/.test(e.activityIcon)&&(a.iconUrl=e.activityIcon),a.bgColor=n||"#D3EDF7",a.btnColor=o||"#1a77ff",a.title=e.name,a.showLogo=!!e.showLogo,a.activityStatus=e.activityStatus,t.setNavigationBarTitle({title:e.name||""})}})).catch((function(){a.loading=!1}))},showCountryDialog:function(){var e=this;this.areaList&&this.areaList.length>0?this.showDialog=!0:(l["a"].showLoading({title:"加载中..."}),t.request({url:"api/usercenter/arealist"}).then((function(t){e.areaList=t.countries,e.showDialog=!0,l["a"].hideLoading()})).catch((function(t){l["a"].hideLoading(),l["a"].showToast({title:t.message||t.msg||"获取国家列表失败"})})))},selectCountry:function(t){this.countryInfo=t},validate:function(){return this.validateObj.phone?(this.illegal={},!0):(this.illegal={phone:!0,warning:"请输入手机号"},l["a"].showToast({title:"请输入手机号"}),!1)},handleSendSMS:function(e){var a=this;this.loading||(this.loading=!0,this.validate()&&t.request({url:p.smsApi,method:"post",data:{mobile:this.validateObj.phone,mobileAreaCode:this.countryInfo.areaCode,ticket:e.ticket,randstr:e.randstr,sourceType:e.sourceType}}).then((function(t){t.existUser;a.loading=!1,a.isSending=!0,clearInterval(a.timer),a.timer=setInterval((function(){a.s-=1,0===a.s&&(a.s=60,a.isSending=!1,clearInterval(a.timer))}),1e3)})).catch((function(t){a.loading=!1,l["a"].showToast({title:t.message||t.msg||"验证码发送出错，请重试"})})))},handleValidate:function(){var e=this,a={activityId:this.activityId,cookie:t.auth.getCookieId()};a=this.isCheckPhone?Object(n["a"])(Object(n["a"])({},a),{},{mobile:this.validateObj.phone,validCode:this.validateObj.sms,mobileAreaCode:this.countryInfo.areaCode}):Object(n["a"])(Object(n["a"])({},a),{},{buyCode:this.validateObj.code}),t.request({url:"api/prod/sqactivitytokencode",method:"POST",data:a}).then((function(a){var n=a.data;if(n){if(n.tokenCode){if(!e.isLogin){var o=d["a"].getSessionStorage("pruchaseinAuth")||[],s=Object(i["a"])(o),r=o.findIndex((function(t){return t.id===e.activityId}));r>-1&&s.splice(r,1),s.push({cookieId:t.auth.getCookieId(),id:e.activityId,code:n.tokenCode}),d["a"].setSessionStorage("pruchaseinAuth",s)}t.showToast({title:"认证成功",duration:1e3});var c=setTimeout((function(){clearTimeout(c),t.isMiniApp?wx.miniProgram.redirectTo({url:"/subPackage/pages/purchasein/purchasein?id=".concat(e.activityId||"","&code=").concat(n.tokenCode)}):t.redirectTo({url:"/pages/purchasein/main?id=".concat(e.activityId||"","&code=").concat(n.tokenCode)})}),1e3);return}if(n.exist){t.showToast({title:"认证成功",duration:1e3});var l=setTimeout((function(){clearTimeout(l),t.isMiniApp?wx.miniProgram.redirectTo({url:"/subPackage/pages/purchasein/purchasein?id=".concat(e.activityId||"")}):t.redirectTo({url:"/pages/purchasein/main?id=".concat(e.activityId||"")})}),1e3);return}}e.handleWarning()})).catch((function(t){var a=t.msg;e.handleWarning(a)}))},handleWarning:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.isCheckPhone?(t.showToast({title:e||"此活动为专属内购，该手机号无权参加~"}),this.illegal={phone:!0,sms:!0,warning:e||"此活动为专属内购，该手机号无权参加~"}):(t.showToast({title:e||"认证失败，请确认内购码是否正确"}),this.illegal={code:!0,warning:e||"认证失败，请确认内购码是否正确"})}}}}).call(this,a("7189")["default"])},"655a":function(t,e,a){},8840:function(t,e,a){"use strict";a("655a")},b2aa:function(t,e,a){"use strict";a("c9e8")},c9e8:function(t,e,a){},cb04:function(t,e,a){"use strict";a.r(e);a("e260"),a("e6cf"),a("cca6"),a("a79d");var i=a("56d7"),n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container purchaseincheck",style:{background:t.bgColor}},[e("purchase-header",{attrs:{bannerUrl:t.bannerUrl||t.defaultBanner,logo:t.iconUrl,name:t.title,bgColor:t.bgColor,showLogo:t.showLogo}}),e("div",{staticClass:"content"},[3===t.activityStatus?e("div",{staticClass:"prod-empty"},[e("img",{staticClass:"empty-img",attrs:{src:a("1d96")}}),e("span",{staticClass:"empty-desc"},[t._v("活动已结束")])]):e("div",{staticClass:"content-check"},[t.isCheckPhone?[e("div",{staticClass:"content-check-phone"},[e("div",{staticClass:"region area",on:{click:t.showCountryDialog}},[e("div",{staticClass:"areaCode"},[t._v("+ "+t._s(t.countryInfo.areaCode))]),e("img",{staticClass:"trip",attrs:{src:a("5800")}})]),e("div",{class:["phone","area",{illegal:t.illegal.phone}]},[e("van-field",{attrs:{type:"tel",placeholder:"请输入手机号"},model:{value:t.validateObj.phone,callback:function(e){t.$set(t.validateObj,"phone",e)},expression:"validateObj.phone"}})],1)]),e("div",{class:["content-check-sms","area",{illegal:t.illegal.sms}]},[e("van-field",{attrs:{center:"",clearable:"",placeholder:"请输入验证码"},scopedSlots:t._u([{key:"button",fn:function(){return[t.isSending?e("div",{staticClass:"sms-text sms-text--disabled"},[t._v(t._s(t.s)+"秒后重新获取")]):e("TCaptcha",{attrs:{loading:t.loading,validate:t.validate},on:{handleSendSMS:t.handleSendSMS}},[e("span",{staticClass:"sms-text"},[t._v("获取验证码")])])]},proxy:!0}],null,!1,2100418620),model:{value:t.validateObj.sms,callback:function(e){t.$set(t.validateObj,"sms",e)},expression:"validateObj.sms"}})],1)]:[e("div",{class:["phone","area",{illegal:t.illegal.code}]},[e("van-field",{attrs:{placeholder:"请输入内购码"},model:{value:t.validateObj.code,callback:function(e){t.$set(t.validateObj,"code",e)},expression:"validateObj.code"}})],1)],t.illegal.warning?e("div",{staticClass:"content-check-warning"},[e("img",{staticClass:"warning-icon",attrs:{src:a("6999")}}),e("span",{staticClass:"warning-text"},[t._v(t._s(t.illegal.warning))])]):t._e(),e("div",{staticClass:"content-check-btn"},[e("van-button",{style:{background:t.btnColor,borderColor:t.btnColor},attrs:{disabled:t.btnDisabled,round:"",type:"info",block:""},on:{click:t.handleValidate}},[t._v("立即认证")])],1)],2)]),e("countryDialog",{attrs:{areaList:t.areaList,countryInfo:t.countryInfo,title:"选择国际电话区号"},on:{selectCountry:t.selectCountry},model:{value:t.showDialog,callback:function(e){t.showDialog=e},expression:"showDialog"}})],1)},o=[],s=a("51ce"),r=s["a"],c=(a("b2aa"),a("8840"),a("2877")),l=Object(c["a"])(r,n,o,!1,null,"79d05e66",null),d=l.exports;a.p=publicPath,Object(i["a"])(d)}});